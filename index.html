<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>2025 æœ€æ–°ç‰ˆ - å°ç©é›»é€£å‹•è©¦ç®—</title>
    <style>
        :root { --primary: #1a73e8; --warn: #f39c12; --danger: #d93025; }
        body { font-family: "PingFang TC", sans-serif; background: #f0f2f5; padding: 20px; display: flex; justify-content: center; }
        .container { width: 100%; max-width: 480px; background: white; padding: 25px; border-radius: 24px; box-shadow: 0 15px 35px rgba(0,0,0,0.1); }
        h2 { text-align: center; color: var(--primary); margin-bottom: 10px; }
        .update-btn { width: 100%; padding: 15px; background: var(--primary); color: white; border: none; border-radius: 12px; font-weight: bold; cursor: pointer; margin-bottom: 15px; }
        .status-box { font-size: 12px; text-align: center; color: #666; margin-bottom: 20px; padding: 10px; background: #f8f9fa; border-radius: 10px; }
        .card { border: 1px solid #eee; border-radius: 16px; padding: 15px; margin-bottom: 15px; position: relative; }
        .card h3 { margin: 0 0 12px 0; font-size: 16px; display: flex; align-items: center; }
        .weight-tag { font-size: 11px; background: #fff3e0; color: #e65100; padding: 2px 8px; border-radius: 20px; margin-left: 10px; border: 1px solid #ffe0b2; }
        .input-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }
        label { font-size: 11px; color: #888; display: block; margin-bottom: 4px; }
        input { width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 8px; box-sizing: border-box; font-size: 16px; }
        .result-area { margin-top: 10px; text-align: right; border-top: 1px dashed #eee; padding-top: 10px; }
        .target-price { color: var(--danger); font-size: 20px; font-weight: bold; }
    </style>
</head>
<body>

<div class="container">
    <h2>å°ç©é›»é ˜å…ˆæŒ‡æ¨™</h2>
    <button class="update-btn" onclick="syncAll()">ğŸ”„ æŠ“å– 2025 æœ€æ–°å³æ™‚å ±åƒ¹</button>
    <div id="status" class="status-box">ç›®å‰ä½¿ç”¨ 2025/12 é è¨­æ¬Šé‡å€¼</div>

    <div class="card" style="border-left: 5px solid var(--warn);">
        <h3>2330 å°ç©é›»</h3>
        <div class="input-grid">
            <div><label>ç¾åƒ¹</label><input type="number" id="tsmc_p" value="1050" oninput="calc()"></div>
            <div><label>é è¨ˆè®Šå‹•</label><input type="number" id="tsmc_chg" value="10" oninput="calc()"></div>
        </div>
    </div>

    <div class="card">
        <h3>0050 å…ƒå¤§å°ç£50 <span class="weight-tag" id="w0050_tag">æ¬Šé‡: 61.5%</span></h3>
        <div class="input-grid">
            <div><label>ç¾åƒ¹</label><input type="number" id="p0050" value="200" oninput="calc()"></div>
            <div><label>å°ç©é›»æ¬Šé‡%</label><input type="number" id="w0050" value="61.5" step="0.1" oninput="calc()"></div>
        </div>
        <div class="result-area">é ä¼°ç›®æ¨™ï¼š<span id="res0050" class="target-price">--</span></div>
    </div>

    <div class="card">
        <h3>0052 å¯Œé‚¦ç§‘æŠ€ <span class="weight-tag" id="w0052_tag">æ¬Šé‡: 69.3%</span></h3>
        <div class="input-grid">
            <div><label>ç¾åƒ¹ (1:5åˆ†å‰²å¾Œ)</label><input type="number" id="p0052" value="35.5" oninput="calc()"></div>
            <div><label>å°ç©é›»æ¬Šé‡%</label><input type="number" id="w0052" value="69.3" step="0.1" oninput="calc()"></div>
        </div>
        <div class="result-area">é ä¼°ç›®æ¨™ï¼š<span id="res0052" class="target-price">--</span></div>
    </div>
</div>

<script>
async function syncAll() {
    const status = document.getElementById('status');
    status.innerText = "â³ æ­£åœ¨ç²å–æœ€æ–°æ•¸æ“š...";
    
    try {
        // æŠ“å–åƒ¹æ ¼ (ä½¿ç”¨ API)
        const getP = async (id) => {
            const r = await fetch(`https://api.finmindtrade.com/api/v4/data?dataset=TaiwanStockPrice&data_id=${id}&start_date=2025-12-10`);
            const j = await r.json();
            return j.data.length ? j.data[j.data.length-1].close : null;
        };

        const [pTSMC, p50, p52] = await Promise.all([getP('2330'), getP('0050'), getP('0052')]);

        if (pTSMC) document.getElementById('tsmc_p').value = pTSMC;
        if (p50) document.getElementById('p0050').value = p50;
        if (p52) document.getElementById('p0052').value = (p52 > 100 ? p52/5 : p52).toFixed(2);

        // å˜—è©¦æŠ“å–æ¬Šé‡ (è‹¥ API å›å‚³å¤ªèˆŠï¼Œå‰‡ç¶­æŒé è¨­é«˜æ¬Šé‡)
        const getW = async (id) => {
            const r = await fetch(`https://api.finmindtrade.com/api/v4/data?dataset=TaiwanStockHolding&data_id=${id}&start_date=2025-11-01`);
            const j = await r.json();
            const h = j.data.filter(x => x.stock_id === "2330").pop();
            return h ? h.holding_percentage : null;
        };

        const [w50, w52] = await Promise.all([getW('0050'), getW('0052')]);
        
        // åªæœ‰ç•¶æŠ“åˆ°çš„æ¬Šé‡é«˜æ–¼ç¾æœ‰å€¼æ™‚æ‰æ›´æ–° (é¿å…æŠ“åˆ°éæ™‚çš„ä½æ¬Šé‡è³‡æ–™)
        if (w50 && w50 > 50) {
            document.getElementById('w0050').value = w50;
            document.getElementById('w0050_tag').innerText = `æ¬Šé‡: ${w50}% (API)`;
        }
        if (w52 && w52 > 60) {
            document.getElementById('w0052').value = w52;
            document.getElementById('w0052_tag').innerText = `æ¬Šé‡: ${w52}% (API)`;
        }

        status.innerText = "âœ… æ•¸æ“šåŒæ­¥å®Œæˆ (" + new Date().toLocaleTimeString() + ")";
        calc();
    } catch(e) {
        status.innerText = "âŒ ç¶²è·¯ç•°å¸¸ï¼Œè«‹æ‰‹å‹•è¼¸å…¥";
    }
}

function calc() {
    const t = parseFloat(document.getElementById('tsmc_p').value) || 1;
    const c = parseFloat(document.getElementById('tsmc_chg').value) || 0;
    const ratio = c / t;

    const p50 = parseFloat(document.getElementById('p0050').value) || 0;
    const w50 = parseFloat(document.getElementById('w0050').value) / 100;
    document.getElementById('res0050').innerText = (p50 * (1 + ratio * w50)).toFixed(2);

    const p52 = parseFloat(document.getElementById('p0052').value) || 0;
    const w52 = parseFloat(document.getElementById('w0052').value) / 100;
    document.getElementById('res0052').innerText = (p52 * (1 + ratio * w52)).toFixed(2);
}

calc(); // åˆå§‹åŒ–
</script>
</body>
</html>
